failed_lead_records'

pixel_lead_records
- id BIGINT UNSIGNED AI
- leadspeek_api_id VARCHAR(20) default NULL
- visitor_id VARCHAR(100) default NULL
- visitor_data TEXT default NULL
- function VARCHAR(100) default NULL
- url VARCHAR(255) DEFAULT NULL
- ip_address VARCHAR(50) default NULL
- date DATETIME default NULL
- timezone varchar(50) default NULL
- screen_width SMALLINT UNSIGNED DEFAULT NULL
- screen_height SMALLINT UNSIGNED DEFAULT NULL
- viewport_width SMALLINT UNSIGNED DEFAULT NULL
- viewport_height SMALLINT UNSIGNED DEFAULT NULL
- pixel_ratio FLOAT DEFAULT NULL
- device_type varchar(50)
- campaign_status ENUM('stopped', 'paused', 'paused_on_run', 'running') DEFAULT NULL
- created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
- updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP

EMM-SANDBOX-APP
JD-TASK-EMM-678 = "record rendering pixel"
JD-TASK-EMM-678-DEV-SYNC

FILE
FRONT
* front\public\px-sandbox.min.js

DATA
* data\app\Models\PixelLeadRecord.php

------

EMM-SANDBOX-API
JD-TASK-EMM-678 = "record rendering pixel"
JD-TASK-EMM-678-DEV-SYNC

FILE
* app\Http\Controllers\Controller.php
* app\Http\Controllers\WebhookController.php
* app\Models\PixelLeadRecord.php

------

DATABASE YANG DITAMBAH

CREATE TABLE IF NOT EXISTS `pixel_lead_records` (
  `id` bigint UNSIGNED NOT NULL AUTO_INCREMENT,
  `leadspeek_api_id` varchar(20) DEFAULT NULL,
  `campaign_status` enum('stopped','paused','paused_on_run','running') DEFAULT 'stopped',
  `lead_fire` smallint DEFAULT '0',
  `md5_list` text,
  `visitor_id` varchar(100) DEFAULT NULL,
  `visitor_data` text,
  `function` varchar(100) DEFAULT NULL,
  `url` text,
  `ip_address` varchar(50) DEFAULT NULL,
  `date` datetime DEFAULT NULL,
  `timezone` varchar(50) DEFAULT NULL,
  `screen_width` smallint UNSIGNED DEFAULT NULL,
  `screen_height` smallint UNSIGNED DEFAULT NULL,
  `viewport_width` smallint UNSIGNED DEFAULT NULL,
  `viewport_height` smallint UNSIGNED DEFAULT NULL,
  `pixel_ratio` float DEFAULT NULL,
  `device_type` varchar(50) DEFAULT NULL,
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

<script id="px-grabber" src="https://asn.emmsandbox.com/px-sandbox.min.js" type="text/javascript"></script>

https://api.emmsandbox.com/pixel?label=861487%7Chttps%3A%2F%2Fsitesettings-api-docs.vercel.app%2F&script=true


1. Kotak Ke-1
Pixel Impressions (Total Hits)
- running       : 10 
- stopped       : 10
- paused        : 10
- paused on run : 10

2. Kotak Ke-2
Pixel Impressions (Unique Visitors)
- running       : 10 
- stopped       : 10
- paused        : 10
- paused on run : 10

3. Kotak Ke-3
Pixel Visitor ID Empty 
10

4. Kotak Ke-4
Pixel Feedback Received
10

hai saya sudah membuat record data orang yang telah menggunakan embeded code saya. lalu saya ingin membuat report seperti pada gambar ke-1. konsep dasar dari ini jadi embeded kode hit ke server saya https://api.emmsandbox.com/pixel?label=... lalu setelah hit itu bakal hit api alocdn dan membuat gif di website yang embed code itu. lalu di server saya https://api.emmsandbox.com/webhook

jadi saya ingin membuat report nya itu seperti kotak pada contoh di atas, untuk data angka nya dibuat dummy saja

jadi nanti dibikin gini saja, dan tempatnya di bawah ZeroBounce Details

-- divider --

|kotak ke-1|kotak ke-2|kotak ke-3|kotak ke-4| 

running : 10    paused        : 10 
stopped : 10    paused_on_run : 10




1. stopped : 10 dan stopped : 10. margin kiri dari : dan margin kanan dari : itu sangat jauh sekali
2. untuk paused : 10 dan paused on run : 10, itu sudah benar jadi jangan dirubah lagi
3. bisa tidak dikasih seperti space-between kaya di flex box pada jadi 

file vue : front\src\pages\Modules\Auth\ConfigApp\ReportAnalytic.vue


hai saya sudah membuat record data orang yang telah menggunakan embeded code saya. lalu saya ingin membuat report seperti pada gambar ke-1. konsep dasar dari ini jadi embeded kode hit ke server saya https://api.emmsandbox.com/pixel?label=... lalu setelah hit itu bakal hit api alocdn dan membuat gif di website yang embed code itu. lalu di server saya https://api.emmsandbox.com/webhook


Contoh Kalimat nya
1. Kotak Ke-1
Pixel Impressions (Total Hits)
- running       : 10 
- stopped       : 10
- paused        : 10
- paused on run : 10

2. Kotak Ke-2
Pixel Impressions (Unique Visitors)
- running       : 10 
- stopped       : 10
- paused        : 10
- paused on run : 10

3. Kotak Ke-3
Pixel Visitor ID Empty 
10

4. Kotak Ke-4
Pixel Feedback Received
10


jadi saya ingin membuat report nya itu seperti kotak pada contoh di atas, untuk data angka nya dibuat dummy saja

jadi nanti dibikin gini saja, dan tempatnya di bawah ZeroBounce Details

-- divider --

|kotak ke-1|kotak ke-2|kotak ke-3|kotak ke-4| 



leadspeek_api_id | campaign status | visitor_id 
// ini dihitung 1 
123456 | running | abcd 
123456 | running | abcd 
987654 | running | abcd 
987654 | running | abcd 
// ini dihitung 1 

// ini dihitung 1 
123456 | stopped | abcd 
123456 | stopped | abcd 
759478 | stopped | abcd 
759478 | stopped | abcd 
// ini dihitung 1 

// ini dihitung 1 
123456 | paused_on_run | abcd 
// ini dihitung 1 

// ini dihitung 1 
123456 | paused | abcd 
// ini dihitung 1



ohh ternyata benar deh pakai ini yang grouping pakai yang ini

DI MYSQL 
SELECT plr.visitor_id, COUNT(DISTINCT CONCAT(plr.leadspeek_api_id, '_', CASE WHEN plr.campaign_status = 'running' THEN plr.campaign_status END)) AS total_running, COUNT(DISTINCT CONCAT(plr.leadspeek_api_id, '_', CASE WHEN plr.campaign_status = 'stopped' THEN plr.campaign_status END)) AS total_stopped, COUNT(DISTINCT CONCAT(plr.leadspeek_api_id, '_', CASE WHEN plr.campaign_status = 'paused' THEN plr.campaign_status END)) AS total_paused, COUNT(DISTINCT CONCAT(plr.leadspeek_api_id, '_', CASE WHEN plr.campaign_status = 'paused_on_run' THEN plr.campaign_status END)) AS total_paused_on_run FROM pixel_lead_records AS plr LEFT JOIN leadspeek_users AS lu ON plr.leadspeek_api_id = lu.leadspeek_api_id LEFT JOIN users AS u ON lu.user_id = u.id WHERE plr.visitor_id IS NOT NULL AND plr.visitor_id <> '' AND DATE_FORMAT(plr.created_at, "%Y%m%d") >= '20251105' AND DATE_FORMAT(plr.created_at, "%Y%m%d") <= '20251105' GROUP BY plr.visitor_id;

kode saya sebelumnya DI LARAVEL, nanti juga di update
public function getPixelLeadRecords($type, $startDate, $endDate, $companyRootId)
{
    $pixelLeadRecords = PixelLeadRecord::from('pixel_lead_records as plr')
                                        ->select([
                                            DB::raw("COUNT(CASE WHEN plr.campaign_status = 'running' THEN 1 END) AS total_running"),
                                            DB::raw("COUNT(CASE WHEN plr.campaign_status = 'stopped' THEN 1 END) AS total_stopped"),
                                            DB::raw("COUNT(CASE WHEN plr.campaign_status = 'paused' THEN 1 END) AS total_paused"),
                                            DB::raw("COUNT(CASE WHEN plr.campaign_status = 'paused_on_run' THEN 1 END) AS total_paused_on_run"),
                                        ])
                                        ->leftJoin('leadspeek_users as lu','plr.leadspeek_api_id','=','lu.leadspeek_api_id')
                                        ->leftJoin('users as u','lu.user_id','=','u.id')
                                        ->whereNotNull('plr.visitor_id')
                                        ->where('plr.visitor_id', '<>', '');
    
    // ketika pilih bedasarkan tipe root nya 
    if(!empty($companyrootid)){
        $pixelLeadRecords->where('u.company_root_id','=',$companyrootid);
    }

    // ketika pilih bedasarkan tanggal nya
    $pixelLeadRecords->where(function($query) use ($startDate,$endDate) {
        if(!empty($startDate) && !empty($endDate)){
            $query->where(DB::raw('DATE_FORMAT(plr.created_at,"%Y%m%d")'),'>=',$startDate)
                  ->where(DB::raw('DATE_FORMAT(plr.created_at,"%Y%m%d")'),'<=',$endDate);
        }else{
            $query->where(DB::raw('DATE_FORMAT(plr.created_at,"%Y%m%d")'),'=',date('Ymd'));
        }
    });

    $result = ['running' => 0, 'stopped' => 0, 'paused' => 0, 'paused_on_run' => 0];
    if($type === 'grouping'){ // mode grouping
        $grouped = $pixelLeadRecords->addSelect('plr.visitor_id')
                                    ->groupBy('plr.visitor_id')
                                    ->get();
        info(__FUNCTION__, [
            'grouped' => $grouped,
            'total_running' => $grouped->sum('total_running'),
            'total_stopped' => $grouped->sum('total_stopped'),
            'total_paused' => $grouped->sum('total_paused'),
            'total_paused_on_run' => $grouped->sum('total_paused_on_run'),
        ]);
        // Sum semua kolom dari hasil grouping
        $result = [
            'running' => (int) $grouped->sum('total_running'),
            'stopped' => (int) $grouped->sum('total_stopped'),
            'paused' => (int) $grouped->sum('total_paused'),
            'paused_run' => (int) $grouped->sum('total_paused_on_run'),
        ];
        $result['total_all'] = $result['running'] + $result['stopped'] + $result['paused'] + $result['paused_run'];
    }else{ // mode detail
        $pixelLeadRecords = $pixelLeadRecords->first();
        $result = [
            'running' => (int) ($pixelLeadRecords->total_running ?? 0),
            'stopped' => (int) ($pixelLeadRecords->total_stopped ?? 0),
            'paused' => (int) ($pixelLeadRecords->total_paused ?? 0),
            'paused_run' => (int) ($pixelLeadRecords->total_paused_on_run ?? 0),
        ];
        $result['total_all'] = $result['running'] + $result['stopped'] + $result['paused'] + $result['paused_run'];
    }

    return $result;
}


sekarang kita fokus sama ksTEM01xcnccA3N1mKEZ0iJ21762335434114, nah nanti berarti 
running nya ada 2
stopped nya ada 1
paused_on_run ada 1

namun saat di bagian total_all nya kita bisa anggap ini jadi 1 orang saja, dan buka jadi (2+1+1)


EMM-SANDBOX-APP
JD-TASK-EMM-692 = "update date pixel lead record after update feedback pixel lead record"
JD-TASK-EMM-692-DEV-SYNC

FILE
DATA
* app\Models\PixelLeadRecord.php
* data\app\Services\Configuration\PixelLeadRecordService.php


EMM-SANDBOX-API
JD-TASK-EMM-692 = "update date pixel lead record after update feedback pixel lead record"
JD-TASK-EMM-692-DEV-SYNC

FILE
* app\Http\Controllers\Controller.php
* app\Http\Controllers\WebhookController.php
* app\Models\PixelLeadRecord.php





ALTER TABLE `pixel_lead_records` ADD `label` TEXT NULL DEFAULT NULL AFTER `md5_list`;
ALTER TABLE `pixel_lead_records` ADD `date_fire` DATE NULL DEFAULT NULL AFTER `lead_fire`;
ALTER TABLE `pixel_lead_records` ADD `pixel_status` ENUM('pending','valid_label','invalid_label') NULL DEFAULT 'valid_label' AFTER `id`;




https://p.alocdn.com/c/6cd7kkmz/a/xtarget/p.gif?label=81151983|http://127.0.0.1:5500/src/index.html|48
https://p.alocdn.com/c/6cd7kkmz/a/xtarget/p.gif?label=81151983%7Chttp%3A%2F%2F127.0.0.1%3A5500%2Fsrc%2Findex.html%7C48

statsCardsBreakdown: []
statsCardPixel: []



SKENARIO 
1. (yang paling penting) ✅
- campaign type = local 
- scenario = case untuk format label local yang baru 
- input = "{campaignid}|{idpixelrecord}|{keyword}" -> "81151983|84|http://127.0.0.1:5500/index1.html"
- output = "{campaignid}|{keyword}|{idpixelrecord}" -> "81151983|http://127.0.0.1:5500/index1.html|86"

2. (yang paling penting) ✅
- campaign type = local
- scenario = case untuk format label local yang lama
- input = "{campaignid}|{keyword}|{idpixelrecord}" -> "81151983|http://127.0.0.1:5500/index1.html|83"
- output = "{campaignid}|{keyword}|{idpixelrecord}" -> "81151983|http://127.0.0.1:5500/index1.html|83"

3. (probabilitas terjadi nya ini sangat kecil, mungkin hanya 1%) ✅
- campaign type = local
- scenario = case dimana format label local yang lama, namun parameter di index ke 2 nya kosong
- input = "{campaignid}|{keyword}" -> "81151983|http://127.0.0.1:5500/index1.html"
- output = "{campaignid}|{keyword}" -> "81151983|http://127.0.0.1:5500/index1.html"

4. (probabilitas terjadi nya ini sangat kecil, mungkin hanya 1%), karena kalau ini terjadi maka yang sebelumnya bisa aja cuman {campaignid} tanpa keyword ✅
- campaign type = local
- scenario = case dimana format label local yang baru, namun parameter di index ke 2 nya kosong
- input = "{campaignid}|{idpixelrecord}" -> "81151983|84"
- output = "{campaignid}|{idpixelrecord}" -> "81151983|84"

5. (yang paling penting) ✅ 
- campaign type = non local
- scenario = case untuk enhance atau b2b misalnya
- input = "{campaignid}|{keyword}" -> "37342075|fashion"
- output = "{campaignid}|{keyword}" -> "37342075|fashion"

misal bentuk nya 12345678-12345678-|muhammadjidan|https://chatgpt.com

1. buat custom param seperti ini 
PxGrabber.setOptions({
    Label: "12345678|" + window.location.href,
    CustomParams: "test123"
});

2. pada saat generate alocdn, json_encode + base64_encode
$CustomParams_JsonEncode = "{"nama":"jidan","email":"jidan@gmail.com"}"
$CustomParams_Base64Encode = "eyJuYW1hIjoiamlkYW4iLCJlbWFpbCI6ImppZGFuQGdtYWlsLmNvbSJ9"

3. buat url alocdn 
$url = https://p.alocdn.com/c/{$webhookcode}/a/xtarget/p.gif?label=12345678-1234-eyJuYW1hIjoiamlkYW4iLCJlbWFpbCI6ImppZGFuQGdtYWlsLmNvbSJ9|https://test.com
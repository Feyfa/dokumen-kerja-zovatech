=============YANG HARUS DIKERJAKAN=============
1. buat get integration campaign di controller dan service ✅
2. buat create integration campaign di controller dan service ✅ 

3. buat list tags zapier integration client di controller dan service 

4. buat get integration client di controller dan service. jangan lupa tambahkan agencyzoom ✅
5. buat create integration client di controller dan service. jangan lupa tambahkan agencyzoom 
=============YANG HARUS DIKERJAKAN=============

url : /developer/campaign/integrations/{campaignid}
request : 
{
    "zapier": {
        "webhook": "required|array|min:1",
        "tags": "required|array|min:1",
        "enable": "boolean|default:false",
        "send_test": "boolean|default:false"
    },
    "agencyzoom": {
        "webhook": "required|array|min:1",
        "enable": "boolean|default:false",
        "send_test": "boolean|default:false"
    }
}

// ZAPIER REQUEST IN APP
{
    "id": 1169,
    "company_id": 164,
    "integration_slug": "zapier",
    "zapier_webhook": [
        "https://jidan11.com",
        "https://jidan21.com"
    ],
    "zapier_tags": [
        "merdeka",
        "hello"
    ],
    "zapier_is_active": 1,
    "zapier_test_enable": 0,
    "leadspeek_api_id": "81087324",
    "campaign_type": "site_id",
    "company_id_zap": 165
}

// AGENCYZOOM REQUEST IN APP
{
    "id": 1169,
    "company_id": 164,
    "integration_slug": "agencyzoom",
    "agencyzoom_webhook": [
        "https://agies1.com",
        "https://agies2.app"
    ],
    "agencyzoom_is_active": 1,
    "agencyzoom_test_enable": 0,
    "leadspeek_api_id": "81087324",
    "company_id_agencyzoom": 165
}







ROUTE
1. UNTUK MENDAPATKAN SEMUA LIST EVENTS
- method: GET
- endpoint: /developer/webhook/events
- response:
{
    "status": "success",
    "message": "",
    "status_code": 200,
    "data": [
        {
            "event": "invoice.succeeded",
            "description": "Triggered when an invoice payment has succeeded."
        },
        {
            "event": "invoice.payment_failed",
            "description": "Triggered when an invoice payment fails."
        }
    ]
}

2. UNTUK MENDAPATKAN ENDPOINTS EVENT
- method: GET
- endpoint: /developer/webhook/endpoints
- response:
{
    "status": "success",
    "message": "",
    "status_code": 200,
    "data": [
        {
            "id": 12312,
            "url": "https://clientdomain.com/webhook",
            "events": [
                "invoice.succeeded",
                "invoice.payment_failed"
            ]
        }
    ]
}

3. UNTUK MEMBUAT ENDPOINTS EVENTS
- method: POST
- endpoint: /developer/webhook/endpoints
- request: 
{
    "url": "https://clientdomain.com/webhook",
    "events": [
        "invoice.succeeded",
        "invoice.payment_failed"
    ], // jika ingin salah satu
    "events": ["*"]
}
- resonse:
{
    "status": "success",
    "message": "create endpoints event successfully",
    "status_code": 200,
}


4. UNTUK UPDATE ENDPOINT EVENTS
method: PUT
endpoint: /developer/webhook/endpoints/{id}
- request:
{
    "url": "https://clientdomain.com/webhook",
    "events": [
        "invoice.succeeded",
        "invoice.payment_failed"
    ], // jika ingin salah satu
    "events": ["*"]
}
- resonse:
{
    "status": "success",
    "message": "update endpoints event successfully",
    "status_code": 200,
}

5. UNTUK DELETE ENDPOINT EVENTS
- method: DELETE
- endpoint: /developer/webhook/endpoints/{id}
- response:
{
    "status": "success",
    "message": "delete endpoints event successfully",
    "status_code": 200,
}

DATABASE
1. `webhook_event_lists`
- id UNSIGNED BIGINT AI
- category ENUM('invoice')
- event VARCHAR(100) DEFAULT NULL
- description VARCHAR(100) DEFAULT NULL
- active ENUM('T','F')
- created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
- updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP

2. 'webhook_event_endpoints'
- id UNSIGNED BIGINT AI
- company_id UNSIGNED BIGINT DEFAULT NULL
- url VARCHAR(255) DEFAULT NULL
- webhook_event_id TEXT DEFAULT NULL
- created_at TIMESTAMP DEFAULT NULL
- updated_at TIMESTAMP DEFAULT NULL

TEMPATNYA DI APP
1. di chargeClient (only siteid, enhance, b2b)
2. di removeClient (only siteid, enhance, b2b)

TEMPATNYA DI API
1. di chargeClient (only siteid, enhance, b2b)
2. di createInvoice (only siteid, enhance, b2b)

EMM-SANDBOX-APP
JD-TASK-EMM-641 = "feat fire event webhook for invoice in open api"
JD-TASK-EMM-641-DEV-SYNC

FILE
DATA
* data\app\Http\Controllers\Controller.php
* data\app\Http\Controllers\LeadspeekController.php
* data\app\Http\Controllers\OpenApiController.php
* data\routes\api.php
* data\app\Jobs\WebhookSendJob.php
* data\app\Models\WebhookEndpoint.php
* data\app\Models\WebhookEvent.php
* data\app\Services\OpenApi\OpenApiWebhookService.php

EMM-SANDBOX-API
JD-TASK-EMM-641 = "feat fire event webhook for invoice in open api"
JD-TASK-EMM-641-DEV-SYNC

FILE
* app\Http\Controllers\MarketingController.php
* app\Http\Controllers\WebhookController.php
* app\Jobs\WebhookSendJob.php
* app\Models\WebhookEndpoint.php
* app\Models\WebhookEvent.php
* app\Services\OpenApi\OpenApiWebhookService.php

DATABASE
CREATE TABLE IF NOT EXISTS `webhook_events` (
  `id` bigint UNSIGNED NOT NULL AUTO_INCREMENT,
  `category` enum('invoice') DEFAULT NULL,
  `event` varchar(100) DEFAULT NULL,
  `description` varchar(100) DEFAULT NULL,
  `active` enum('T','F') DEFAULT 'T',
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
INSERT INTO `webhook_events` (`id`, `category`, `event`, `description`, `active`, `created_at`, `updated_at`) VALUES
(1, 'invoice', 'invoice.succeeded', 'Triggered when an invoice payment has succeeded.', 'T', NOW(), NOW()),
(2, 'invoice', 'invoice.payment_failed', 'Triggered when an invoice payment fails.', 'T', NOW(), NOW());

CREATE TABLE IF NOT EXISTS `webhook_endpoints` (
  `id` bigint UNSIGNED NOT NULL AUTO_INCREMENT,
  `company_id` bigint UNSIGNED DEFAULT NULL,
  `url` varchar(255) DEFAULT NULL,
  `webhook_event_id` text,
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

Route::get('/developer/contacts/campaign/{campaignid}', 'OpenApiController@getContactsByCampaign'); // get all contacts by campaign id ?page=1&limit=10&startdate='2023-05-09 00:00:00'&enddate='2023-05-10 00:00:00'
Route::get('/developer/contacts/client/{clientid}', 'OpenApiController@getContactsByClient'); // get all contacts by client id ?page=1&limit=10&module='local|enhance|b2b'
Route::get('/developer/contacts/{contactid}', 'OpenApiController@getContactById'); // find contact by id

$taxBillInformation = array_filter([
    $_tax_bill_mailing_address, // tax_bill_mailing_address
    $_tax_bill_mailing_city, // tax_bill_mailing_city
    !empty($_tax_bill_mailing_county) ? "{$_tax_bill_mailing_county} County" : null, // tax_bill_mailing_county
    $_tax_bill_mailing_state, // tax_bill_mailing_state
    trim(
        $_tax_bill_mailing_zip . // tax_bill_mailing_zip
        ($_tax_bill_mailing_zip && $_tax_bill_mailing_zip4 ? "-" : "") . // tax_bill_mailing_zip4
        $_tax_bill_mailing_zip4, "-"
    )
]);  
$taxBillInformationString = implode(", ", $taxBillInformation);


$columns = $this->getColumnsQueryContacts($campaignType); info(['campaignType' => $campaignType,'columns' => $columns]);
$contacts = LeadspeekReport::from('leadspeek_reports as lr')
                            ->select($columns)
                            ->join('leadspeek_users as lu', 'lu.leadspeek_api_id', '=', 'lr.leadspeek_api_id')
                            ->leftJoin('person_advance_1 as pa1', 'pa1.person_id', '=', 'lr.person_id')
                            ->leftJoin('person_b2b as pb', 'pb.person_id', '=', 'lr.person_id')
                            ->where('lu.user_id', $client_id)
                            ->where('lr.active', 'T');

EMM-SANDBOX-APP
JD-TASK-EMM-643 = "open api get contacts details"
JD-TASK-EMM-643-DEV-SYNC

FILE
DATA
* data\app\Http\Controllers\OpenApiController.php
* data\routes\api.php
* data\app\Services\OpenApi\OpenApiContactsService.php

1. untuk mendapatkan data by campaign id
- method: GET
- endpoint: http://datalocal.emmsandbox.com/api/v1/developer/contacts/campaign/37362347?page=1&limit=1&start_date=2020-10-22&end_date=2020-10-23
- query parameter:
    * page: optional, integer, minimum 1, default 1
    * limit: optional, integer, minimum 1, default 10
    * start_date: optional, date, format YYYY-MM-DD 
    * end_date: optional, date, format YYYY-MM-DD
- response: 
{
    "status": "success",
    "message": "",
    "status_code": 200,
    "current_page": 1,
    "last_page": 5,
    "per_page": 1,
    "total": 5,
    "data": [
        {
            "campaign_id": "37362347",
            "campaign_type": "enhance",
            "contact_id": "5062871761140055",
            "created": "2020-10-22",
            "first_name": "Krista",
            "last_name": "29467 Tropea Dr",
            "email": "ptrhrt57@gmail.com",
            "email2": "",
            "phone": "5868567638",
            "phone2": "5868557639",
            "address2": "",
            "city": "Warren",
            "state": "MI",
            "zipcode": "48092",
            "keyword": "fashion",
            "gender": "F",
            "marital_status": "Married",
            "phone3": "",
            "dwelling_type": "Single Family",
            "home_owner": "Home Owner",
            "home_owner_ordinal": "4",
            "length_of_residence": "7",
            "home_price": "170000",
            "home_value": "262200",
            "median_home_value": "90000",
            "living_sqft": "1688",
            "year_built_original": "1965",
            "year_built_range": "8",
            "lot_number": "134",
            "legal_description": "CARLETON ESTATES SUB. LOT 134 L.53 P.7-9",
            "land_sqft": "9104",
            "garage_sqft": "428",
            "subdivision": "CARLETON ESTATES SUB",
            "zoning_code": "R-1-C",
            "household_income": "",
            "median_household_income": "300000",
            "household_net_worth": "F. $25,000 - $49,999",
            "median_household_net_worth": "37500",
            "discretionary_income": "H. $75,000-$99,999",
            "credit_score_median": "625",
            "credit_score_range": "",
            "number_of_adults_household": "3",
            "number_of_children_household": "4",
            "number_of_persons_household": "2",
            "children_aged_0_3_household": "",
            "children_aged_4_6_household": "1",
            "children_aged_7_9_household": "1",
            "children_aged_10_12_household": "",
            "children_aged_13_18_household": "",
            "children_in_household": "1",
            "cooking": "",
            "gardening": "",
            "music": "1",
            "diy": "1",
            "books": "1",
            "travel_vacation": "",
            "health_beauty_products": "",
            "pet_owner": "",
            "photography": "1",
            "fitness": "1",
            "epicurean": "",
            "occupation_category": "Professional",
            "occupation_type": "White Collar",
            "occupation_detail": "Nurse (Registered)",
            "magazine_subscriber": "",
            "charity_interest": "1",
            "likely_charitable_donor": "1",
            "cbsa": "19820",
            "census_block": "2007",
            "census_block_group": "2",
            "census_tract": "260900",
            "voter": "",
            "urbanicity": "4. Urban",
            "tax_bill_mailing_information": "29467 Tropea Dr, Warren, Macomb County, MI, 48092-3322"
        }
    ]
}


2. untuk mendapatkan data by client id
- method: GET
- endpoint: http://datalocal.emmsandbox.com/api/v1/developer/contacts/client/282/b2b?page=1&limit=1&start_date=2020-01-17&end_date=2024-10-18
- query parameter:
    * page: optional, integer, minimum 1, default 1
    * limit: optional, integer, minimum 1, default 10
    * start_date: optional, date, format YYYY-MM-DD 
    * end_date: optional, date, format YYYY-MM-DD
- response: 
{
    "status": "success",
    "message": "",
    "status_code": 200,
    "current_page": 1,
    "last_page": 1,
    "per_page": 1,
    "total": 1,
    "data": [
        {
            "campaign_id": "75935502",
            "campaign_type": "b2b",
            "contact_id": "9188471756889722",
            "created": "2024-09-03",
            "first_name": "Krista",
            "last_name": "29467 Tropea Dr",
            "email": "ptrhrt57@gmail.com",
            "email2": "sadasd",
            "phone": "5868567638",
            "phone2": "5868557639",
            "address2": "Address2",
            "city": "Warren",
            "state": "MI",
            "zipcode": "48092",
            "keyword": "fashion",
            "employee_id": "594496130",
            "company_name": "LIBERTY CHAPEL CHURCH",
            "company_website": "libertychapelchurch.com",
            "num_employees": "1 TO 49",
            "sales_volume": "LESS THAN $500.000",
            "year_founded": "0",
            "job_title": "Office Manager",
            "level": "MANAGER-LEVEL",
            "job_function": "MANAGMENT",
            "headquarters_branch": "0",
            "naics_code": "813110",
            "last_seen_date": "2001-01-01",
            "linkedin ": "linkedin.com/in/michael-barbella-00166589"
        }
    ]
}

3. untuk mendapatkan data by client id
- method: GET
- endpoint: http://datalocal.emmsandbox.com/api/v1/developer/contacts/2180971750666737
- response: 
{
    "status": "success",
    "message": "",
    "status_code": 200,
    "data": {
        "campaign_id": "75935502",
        "campaign_type": "b2b",
        "contact_id": "9188471756889722",
        "created": "2024-09-03",
        "first_name": "Krista",
        "last_name": "29467 Tropea Dr",
        "email": "ptrhrt57@gmail.com",
        "email2": "sadasd",
        "phone": "5868567638",
        "phone2": "5868557639",
        "address2": "Address2",
        "city": "Warren",
        "state": "MI",
        "zipcode": "48092",
        "keyword": "fashion",
        "employee_id": "594496130",
        "company_name": "LIBERTY CHAPEL CHURCH",
        "company_website": "libertychapelchurch.com",
        "num_employees": "1 TO 49",
        "sales_volume": "LESS THAN $500.000",
        "year_founded": "0",
        "job_title": "Office Manager",
        "level": "MANAGER-LEVEL",
        "job_function": "MANAGMENT",
        "headquarters_branch": "0",
        "naics_code": "813110",
        "last_seen_date": "2001-01-01",
        "linkedin ": "linkedin.com/in/michael-barbella-00166589"
    }
}
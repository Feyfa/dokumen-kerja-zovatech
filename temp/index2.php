<?php

// Paste raw response dari Insomnia/Postman langsung ke sini
$rawResponseResolveIdentities = 'event: message
data: {"result":{"content":[{"type":"text","text":"{\"identities\":[{\"person_id\":12921488,\"matches\":[{\"criterion_type\":\"email_md5\",\"criterion_value\":\"8bc64c9c289d18a05dd9652422208f05\",\"quality_score\":1}],\"overall_quality_score\":1,\"identifiers\":{\"emails\":[{\"email_address\":\"ptrhrt57@gmail.com\",\"opted_in\":true}]}}],\"stats\":{\"requested\":1,\"resolved\":1,\"rate\":1},\"workflow_id\":\"16b88f0e-16da-4c15-b7f2-41e2b8326908\",\"tool_trace_id\":\"c538f45892cb4f3c7de4fc54039163d9\"}"}]},"jsonrpc":"2.0","id":1}';

$rawResponseGetPerson = 'event: message
data: {"result":{"content":[{"type":"text","text":"{\"profiles\":[{\"person_id\":\"12921488\",\"domains\":{\"phones\":[{\"phone_number\":\"+15867732982\",\"phone_type\":\"work\",\"carrier\":\"Michigan Bell Tel Co\",\"do_not_call\":true},{\"phone_number\":\"+19892246655\",\"phone_type\":\"work\",\"carrier\":\"Frontier Communications\",\"do_not_call\":true}],\"emails\":[{\"email_address\":\"ptrhrt57@gmail.com\",\"opted_in\":true}],\"names\":[{\"first_name\":\"Diane\",\"last_name\":\"Harte\"}],\"addresses\":[{\"address_primary\":\"1033 Bills Ln\",\"address_secondary\":null,\"city\":\"Saint Johns\",\"state\":\"MI\",\"zip\":\"48879-1183\",\"county\":\"Clinton\",\"carrier_route\":\"R008\",\"latitude\":43.012516,\"longitude\":-84.548706,\"dma\":551,\"cbsa\":29620,\"msa\":4040,\"congressional_district\":4,\"urbanicity_code\":\"R\",\"property_type\":null}],\"affinity\":{\"home_decorating_affinity\":{\"value\":\"medium\",\"cluster_id\":81},\"gambling_affinity\":{\"value\":\"medium\",\"cluster_id\":64},\"tv_movies_affinity\":{\"value\":\"medium\",\"cluster_id\":132},\"home_office_affinity\":{\"value\":\"high\",\"cluster_id\":82},\"womens_home_living_affinity\":{\"value\":\"high\",\"cluster_id\":139},\"family_affinity\":{\"value\":\"high\",\"cluster_id\":57},\"gardening_affinity\":{\"value\":\"medium\",\"cluster_id\":68},\"fitness_affinity\":{\"value\":\"medium\",\"cluster_id\":61},\"mens_apparel_affinity\":{\"value\":\"medium\",\"cluster_id\":95},\"womens_apparel_affinity\":{\"value\":\"medium\",\"cluster_id\":136},\"high_tech_affinity\":{\"value\":\"medium\",\"cluster_id\":76},\"catalog_affinity\":{\"value\":\"high\",\"cluster_id\":26},\"collectibles_affinity\":{\"value\":\"medium\",\"cluster_id\":29}},\"content\":{\"catalog_total_spend\":{\"value\":\"high_spend\",\"cluster_id\":1000009},\"reads_avid_reader\":{\"value\":true,\"cluster_id\":1000083},\"reads_medical_health\":{\"value\":false,\"cluster_id\":1000111},\"reads_world_news_politics\":{\"value\":false,\"cluster_id\":1000121},\"number_housewares_catalogs\":{\"value\":\"single_catalog\",\"cluster_id\":1000052},\"reads_military\":{\"value\":false,\"cluster_id\":1000113},\"reads_computer_it\":{\"value\":false,\"cluster_id\":1000089},\"reads_country_lifestyle\":{\"value\":false,\"cluster_id\":1000093},\"reads_science_fiction\":{\"value\":false,\"cluster_id\":1000115},\"reads_bible_devotional\":{\"value\":false,\"cluster_id\":1000084},\"reads_childrens\":{\"value\":true,\"cluster_id\":1000088},\"reads_cooking_culinary\":{\"value\":false,\"cluster_id\":1000091},\"reads_entertainment\":{\"value\":false,\"cluster_id\":1000095},\"catalog_avg_spend\":{\"value\":\"low_volume\",\"cluster_id\":1000001},\"reads_science_technology\":{\"value\":false,\"cluster_id\":1000117},\"reads_magazines\":{\"value\":true,\"cluster_id\":1000110},\"subscribes_magazines\":{\"value\":false,\"cluster_id\":1000123},\"catalog_total_orders\":{\"value\":\"low_volume\",\"cluster_id\":1000007},\"catalog_total_items\":{\"value\":\"low_volume\",\"cluster_id\":1000004},\"reads_books_on_tape\":{\"value\":false,\"cluster_id\":1000085},\"reads_health_remedies\":{\"value\":false,\"cluster_id\":1000103},\"reads_history\":{\"value\":false,\"cluster_id\":1000105},\"number_family_related_catalogs\":{\"value\":\"single_catalog\",\"cluster_id\":1000028},\"reads_finance\":{\"value\":false,\"cluster_id\":1000101},\"reads_fashion\":{\"value\":false,\"cluster_id\":1000097},\"reads_interior_decorating\":{\"value\":false,\"cluster_id\":1000107},\"number_catalogs\":{\"value\":\"dual_catalog\",\"cluster_id\":1000017},\"reads_sports\":{\"value\":false,\"cluster_id\":1000119},\"reads_fiction\":{\"value\":false,\"cluster_id\":1000099},\"number_home_living_catalogs\":{\"value\":\"single_catalog\",\"cluster_id\":1000046}},\"demographic\":{\"attribute_domain\":\"demographic\",\"attribute_name\":\"language_spoken\",\"attribute_value\":\"English\",\"attribute_data_type\":\"CHARACTER VARYING\",\"source_date\":\"2025-12-16\",\"vendor\":\"datashopper\",\"ethnic_group\":{\"value\":\"White\",\"cluster_id\":2000012},\"marital_status\":{\"value\":\"Married\",\"cluster_id\":2000023},\"generation\":{\"value\":\"3. Baby Boomers (1943-1960)\",\"cluster_id\":2000017},\"gender\":{\"value\":\"Female\",\"cluster_id\":2000013},\"religion\":{\"value\":\"Catholic\",\"cluster_id\":2000026},\"is_multilingual\":{\"value\":false,\"cluster_id\":2000019},\"is_speaks_english\":{\"value\":true,\"cluster_id\":2000022},\"education\":{\"value\":\"Completed High School\",\"cluster_id\":2000003}},\"employment\":{\"occupation_category\":{\"value\":\"Professional\",\"cluster_id\":3000004},\"attribute_domain\":\"employment\",\"attribute_name\":\"occupation_detail\",\"attribute_value\":\"Professional\",\"attribute_data_type\":\"CHARACTER VARYING\",\"source_date\":\"2025-12-16\",\"vendor\":\"datashopper\"},\"financial\":{\"donated_childrens_cause\":{\"value\":false,\"cluster_id\":4000015},\"owns_amex_card\":{\"value\":false,\"cluster_id\":4000041},\"owns_bank_credit_card\":{\"value\":true,\"cluster_id\":4000044},\"owns_premium_amex_card\":{\"value\":false,\"cluster_id\":4000049},\"has_investments\":{\"value\":false,\"cluster_id\":4000025},\"donated_arts_cultural_cause\":{\"value\":false,\"cluster_id\":4000013},\"owns_stocks_and_bonds\":{\"value\":false,\"cluster_id\":4000053},\"individual_income_range\":{\"value\":\"GT_150K\",\"cluster_id\":4000031},\"credit_rating_range\":{\"value\":\"B. 750-799\",\"cluster_id\":4000004},\"donated_veterans_cause\":{\"value\":false,\"cluster_id\":4000023},\"owns_investments\":{\"value\":false,\"cluster_id\":4000047},\"owns_premium_credit_card\":{\"value\":false,\"cluster_id\":4000051},\"is_charitable_donor\":{\"value\":true,\"cluster_id\":4000034},\"donated_animal_cause\":{\"value\":false,\"cluster_id\":4000011},\"donated_religious_cause\":{\"value\":false,\"cluster_id\":4000021},\"owns_credit_card\":{\"value\":true,\"cluster_id\":4000046},\"donated_environmental_cause\":{\"value\":false,\"cluster_id\":4000017},\"donated_health_cause\":{\"value\":false,\"cluster_id\":4000019}},\"household\":{\"residence_duration\":{\"value\":\"long_term\",\"cluster_id\":5000094},\"has_child_aged_13_18_in_household\":{\"value\":true,\"cluster_id\":5000010},\"household_net_worth_range\":{\"value\":\"G. $50,000 - $99,999\",\"cluster_id\":5000070},\"number_credit_lines_in_household\":{\"value\":\"significant\",\"cluster_id\":5000082},\"number_adults_in_household\":{\"value\":\"multi_adult\",\"cluster_id\":5000075},\"has_veteran_in_household\":{\"value\":false,\"cluster_id\":5000017},\"has_child_aged_4_6_in_household\":{\"value\":false,\"cluster_id\":5000011},\"has_child_aged_0_3_in_household\":{\"value\":false,\"cluster_id\":5000005},\"number_vehicles_in_household\":{\"value\":\"multi_vehicle\",\"cluster_id\":5000091},\"number_persons_in_household\":{\"value\":\"multi_person\",\"cluster_id\":5000088},\"credit_offered_to_household\":{\"value\":\"sizeable\",\"cluster_id\":5000004},\"has_child_aged_10_12_in_household\":{\"value\":true,\"cluster_id\":5000008},\"number_generations_in_household\":{\"value\":\"multi_generations\",\"cluster_id\":5000085},\"has_child_aged_7_9_in_household\":{\"value\":false,\"cluster_id\":5000013},\"household_income_range\":{\"value\":\"E. $60K-$70K\",\"cluster_id\":5000030},\"has_children_in_household\":{\"value\":false,\"cluster_id\":5000015}},\"interest\":{\"interested_hunting\":{\"value\":false,\"cluster_id\":7000058},\"interested_cruise_travel\":{\"value\":false,\"cluster_id\":7000026},\"interested_fitness\":{\"value\":true,\"cluster_id\":7000039},\"interested_cooking\":{\"value\":true,\"cluster_id\":7000025},\"interested_fishing\":{\"value\":false,\"cluster_id\":7000036},\"interested_music\":{\"value\":false,\"cluster_id\":7000066},\"interested_knitting_quilting_sewing\":{\"value\":false,\"cluster_id\":7000060},\"interested_home_improvement\":{\"value\":true,\"cluster_id\":7000055},\"interested_baseball\":{\"value\":false,\"cluster_id\":7000006},\"interested_snow_skiing\":{\"value\":false,\"cluster_id\":7000082},\"interested_antiques_collector\":{\"value\":true,\"cluster_id\":7000003},\"interested_sports_memorabilia_collector\":{\"value\":false,\"cluster_id\":7000086},\"interested_arts_and_crafts\":{\"value\":false,\"cluster_id\":7000004},\"interested_outdoors_hunting\":{\"value\":false,\"cluster_id\":7000074},\"interested_scuba\":{\"value\":false,\"cluster_id\":7000078},\"interested_outdoors\":{\"value\":true,\"cluster_id\":7000073},\"interested_hockey\":{\"value\":false,\"cluster_id\":7000050},\"interested_soccer\":{\"value\":false,\"cluster_id\":7000084},\"interested_gardening\":{\"value\":true,\"cluster_id\":7000045},\"interested_home_decor\":{\"value\":true,\"cluster_id\":7000053},\"interested_gambling\":{\"value\":false,\"cluster_id\":7000042},\"interested_photography\":{\"value\":false,\"cluster_id\":7000076},\"interested_musical_instruments\":{\"value\":false,\"cluster_id\":7000068},\"interested_epicurean\":{\"value\":false,\"cluster_id\":7000032},\"interested_cars\":{\"value\":true,\"cluster_id\":7000017},\"interested_motor_racing\":{\"value\":false,\"cluster_id\":7000062},\"interested_aerobics\":{\"value\":false,\"cluster_id\":7000000},\"interested_fine_arts_collector\":{\"value\":false,\"cluster_id\":7000034},\"interested_charity\":{\"value\":true,\"cluster_id\":7000019},\"interested_entertainment\":{\"value\":false,\"cluster_id\":7000030},\"interested_woodworking\":{\"value\":false,\"cluster_id\":7000094},\"interested_healthy_living\":{\"value\":true,\"cluster_id\":7000049},\"interested_tennis\":{\"value\":false,\"cluster_id\":7000090},\"interested_movies\":{\"value\":true,\"cluster_id\":7000065},\"interested_boating_sailing\":{\"value\":false,\"cluster_id\":7000012},\"interested_camping_hiking\":{\"value\":false,\"cluster_id\":7000014},\"interested_nascar\":{\"value\":false,\"cluster_id\":7000070},\"interested_stamps_collector\":{\"value\":false,\"cluster_id\":7000088},\"interested_dieting\":{\"value\":false,\"cluster_id\":7000028},\"interested_basketball\":{\"value\":false,\"cluster_id\":7000008},\"interested_coins_collector\":{\"value\":false,\"cluster_id\":7000022},\"interested_golf\":{\"value\":false,\"cluster_id\":7000046},\"interested_bird_watching\":{\"value\":false,\"cluster_id\":7000010},\"interested_walking\":{\"value\":false,\"cluster_id\":7000092},\"interested_self_improvement\":{\"value\":false,\"cluster_id\":7000080},\"interested_football\":{\"value\":false,\"cluster_id\":7000040},\"interested_home_study\":{\"value\":false,\"cluster_id\":7000056},\"interested_cigars\":{\"value\":false,\"cluster_id\":7000020}},\"lifestyle\":{\"is_pet_owner\":{\"value\":false,\"cluster_id\":8000017},\"is_health_conscious\":{\"value\":true,\"cluster_id\":8000009},\"is_dog_owner\":{\"value\":false,\"cluster_id\":8000006},\"has_luxury_lifestyle\":{\"value\":false,\"cluster_id\":8000002},\"is_home_owner\":{\"value\":true,\"cluster_id\":8000011},\"practices_diy\":{\"value\":false,\"cluster_id\":8000029},\"owns_swimming_pool\":{\"value\":false,\"cluster_id\":8000027},\"is_cat_owner\":{\"value\":false,\"cluster_id\":8000004},\"is_truck_owner\":{\"value\":false,\"cluster_id\":8000023},\"has_home_business\":{\"value\":false,\"cluster_id\":8000000},\"is_renter\":{\"value\":false,\"cluster_id\":8000019},\"is_rv_owner\":{\"value\":false,\"cluster_id\":8000021},\"is_vacation_traveler\":{\"value\":true,\"cluster_id\":8000026},\"is_international_traveler\":{\"value\":false,\"cluster_id\":8000012},\"is_motorcycle_owner\":{\"value\":false,\"cluster_id\":8000015}},\"political\":{\"donated_political_social_cause_recently\":{\"value\":false,\"cluster_id\":9000006},\"donated_conservative_cause_recently\":{\"value\":false,\"cluster_id\":9000000},\"donated_liberal_cause_recently\":{\"value\":false,\"cluster_id\":9000002},\"donated_political_cause_recently\":{\"value\":true,\"cluster_id\":9000005},\"is_political_contributor\":{\"value\":false,\"cluster_id\":9000008}},\"purchase\":{\"purchased_cosmetics\":{\"value\":false,\"cluster_id\":10000202},\"purchased_jewelry\":{\"value\":true,\"cluster_id\":10000213},\"family_purchases_avg_spend\":{\"value\":\"low_volume\",\"cluster_id\":10000075},\"tv_movies_purchases_num_companies\":{\"value\":\"single_company\",\"cluster_id\":10000232},\"computer_purchases_num_companies\":{\"value\":\"single_company\",\"cluster_id\":10000046},\"general_merchandise_purchases_num_companies\":{\"value\":\"single_company\",\"cluster_id\":10000102},\"family_purchases_total_orders\":{\"value\":\"low_volume\",\"cluster_id\":10000081},\"purchased_clothing\":{\"value\":true,\"cluster_id\":10000201},\"purchased_books\":{\"value\":false,\"cluster_id\":10000196},\"gift_purchases_num_companies\":{\"value\":\"single_company\",\"cluster_id\":10000105},\"family_purchases_total_items\":{\"value\":\"low_volume\",\"cluster_id\":10000078},\"purchased_home_improvement\":{\"value\":true,\"cluster_id\":10000211},\"travel_purchases_num_companies\":{\"value\":\"single_company\",\"cluster_id\":10000229},\"holiday_purchases_num_companies\":{\"value\":\"single_company\",\"cluster_id\":10000128},\"continuity_purchases_num_companies\":{\"value\":\"multi_company\",\"cluster_id\":10000051},\"health_purchases_total_items\":{\"value\":\"medium_volume\",\"cluster_id\":10000114},\"purchased_gifts\":{\"value\":true,\"cluster_id\":10000205},\"purchased_home_furnishing\":{\"value\":true,\"cluster_id\":10000209},\"purchased_health_beauty_products\":{\"value\":false,\"cluster_id\":10000206},\"home_goods_purchases_total_items\":{\"value\":\"low_volume\",\"cluster_id\":10000136},\"purchased_auto_parts\":{\"value\":true,\"cluster_id\":10000195},\"purchased_musical_instruments\":{\"value\":false,\"cluster_id\":10000214},\"culture_arts_purchases_num_companies\":{\"value\":\"single_company\",\"cluster_id\":10000064},\"purchased_plus_size_clothing\":{\"value\":false,\"cluster_id\":10000216},\"home_goods_purchases_total_orders\":{\"value\":\"low_volume\",\"cluster_id\":10000139},\"home_goods_purchases_total_spend\":{\"value\":\"medium_spend\",\"cluster_id\":10000143},\"family_purchases_total_spend\":{\"value\":\"low_spend\",\"cluster_id\":10000084},\"home_goods_purchases_avg_spend\":{\"value\":\"low_volume\",\"cluster_id\":10000133},\"purchased_childrens_products\":{\"value\":true,\"cluster_id\":10000199}}}}],\"export\":{\"url\":\"https://watt-mcp-exports-dev.s3.us-east-1.amazonaws.com/exports/1771476164170-b8a8f8d9-283b-4ef5-b0ab-48b318e17742.csv?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAXAJLZ62S262D3DQV%2F20260219%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20260219T044244Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEKz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLWVhc3QtMSJHMEUCIQCTOss8RFVCDjr9jRWloEWrA0AGtCNmdk3fOGuQU5UjHQIgD6MPcFLkhvqLywgeU5B0WeThU1yomtep3KxBaH5r4xYqqwQIdBAAGgw0ODE2NjUwODcxNDEiDFEwLRMQiETJu%2FEYjSqIBNADBnCjsHoU92nRLJ5tbko21qk0P0tSTz5d64N8gXE5rZ2yqG1l7bNXCQ2Oj8ygOiICXwnzB7x%2BuguZ0O%2F1TYRm%2B0GSLHo2wdjEllGD1jYyzY4PVDeS4eWk9xrINUZcCWs2erEQiYCoehBpzxs91x3UG9pkZJ6%2BUb%2BGcV67E%2BeHtfgry%2FdOVCimRT47c9%2BkAiVjmS6vjjy3BD8fBT57bT2VfOv8sOAhgCrC0OQrMbf4Ac4hiOJOKdiMQn0afIZ7lZJrXVMcLVvt3SEy1vKeOV50I85gMfJzA49ONUN7BMM9ZAXraD5BAF8frk9KJdmK84quz%2BRAkQ55dMHdOBr7Mjll1NYUeP58SZr2V%2FBxzOHpm2H6cO35%2F0uf1MMdGDt4h8lIhlIUvxVM0MT5YYqaKwiAn6GBe%2BpJToegqLhvkmRyxjxZe9vjdofE2iYAzl1D%2FcVwICGoNrQ68vbdZjbK6YO20o5WP782aCDvAiHGORq7IlHKJdscBchWGQ7Yzkzz3RmHdDUbUyS9riDuCdvgTMYPuvmpxvrZg2J4AqL6TgMQUINT4sGSEWQcl0E%2BSuDA9gRcixSLO%2BHpHrEPmzuQpnEZjt%2F%2FD%2FplwAz818I8KK18C%2BzYCSRkYJNVtP7Kqhyhn36miOGAaLQXB2tjcrXna3VtF7ALxG%2BrxLuRz3pdOMe2ujjm66uyfSww6%2FzZzAY6pgHGb9wrpVVQoscDBjNcZ62iNqyHOJk4fIApZ5WFxKOWhc%2FCNipQ8Xki63911nqP%2BNfAMSlCvGC%2BTqG14mKz3k39HoUVTi%2FbSa8OptnhKN8C%2BQZjL5lUXUYhdEtWqMb%2FPPsq1d6Y0fUwWXCHElAhbJiHsOG7Y8O0SZtzgJjfX4Osg3Ah0QOJEXY7X4mxM7ptxo7QZk89I9rtdU2TnNwi3Zh%2F52OGJl2c&X-Amz-Signature=4eaa9cbdc45a95aa8319168f458469d8ddbc62af2a1e49d8ec5101e8512d80c5&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject\",\"format\":\"csv\",\"rows\":1,\"size_bytes\":0,\"expires_at\":\"2026-02-19T05:42:44.255Z\"},\"workflow_id\":\"668c66c5-e740-4760-80df-a5776db4f047\",\"tool_trace_id\":\"a3e4e1a9f78a274840ed362917f86d41\"}"},{"type":"resource","resource":{"uri":"https://watt-mcp-exports-dev.s3.us-east-1.amazonaws.com/exports/1771476164170-b8a8f8d9-283b-4ef5-b0ab-48b318e17742.csv?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAXAJLZ62S262D3DQV%2F20260219%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20260219T044244Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEKz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLWVhc3QtMSJHMEUCIQCTOss8RFVCDjr9jRWloEWrA0AGtCNmdk3fOGuQU5UjHQIgD6MPcFLkhvqLywgeU5B0WeThU1yomtep3KxBaH5r4xYqqwQIdBAAGgw0ODE2NjUwODcxNDEiDFEwLRMQiETJu%2FEYjSqIBNADBnCjsHoU92nRLJ5tbko21qk0P0tSTz5d64N8gXE5rZ2yqG1l7bNXCQ2Oj8ygOiICXwnzB7x%2BuguZ0O%2F1TYRm%2B0GSLHo2wdjEllGD1jYyzY4PVDeS4eWk9xrINUZcCWs2erEQiYCoehBpzxs91x3UG9pkZJ6%2BUb%2BGcV67E%2BeHtfgry%2FdOVCimRT47c9%2BkAiVjmS6vjjy3BD8fBT57bT2VfOv8sOAhgCrC0OQrMbf4Ac4hiOJOKdiMQn0afIZ7lZJrXVMcLVvt3SEy1vKeOV50I85gMfJzA49ONUN7BMM9ZAXraD5BAF8frk9KJdmK84quz%2BRAkQ55dMHdOBr7Mjll1NYUeP58SZr2V%2FBxzOHpm2H6cO35%2F0uf1MMdGDt4h8lIhlIUvxVM0MT5YYqaKwiAn6GBe%2BpJToegqLhvkmRyxjxZe9vjdofE2iYAzl1D%2FcVwICGoNrQ68vbdZjbK6YO20o5WP782aCDvAiHGORq7IlHKJdscBchWGQ7Yzkzz3RmHdDUbUyS9riDuCdvgTMYPuvmpxvrZg2J4AqL6TgMQUINT4sGSEWQcl0E%2BSuDA9gRcixSLO%2BHpHrEPmzuQpnEZjt%2F%2FD%2FplwAz818I8KK18C%2BzYCSRkYJNVtP7Kqhyhn36miOGAaLQXB2tjcrXna3VtF7ALxG%2BrxLuRz3pdOMe2ujjm66uyfSww6%2FzZzAY6pgHGb9wrpVVQoscDBjNcZ62iNqyHOJk4fIApZ5WFxKOWhc%2FCNipQ8Xki63911nqP%2BNfAMSlCvGC%2BTqG14mKz3k39HoUVTi%2FbSa8OptnhKN8C%2BQZjL5lUXUYhdEtWqMb%2FPPsq1d6Y0fUwWXCHElAhbJiHsOG7Y8O0SZtzgJjfX4Osg3Ah0QOJEXY7X4mxM7ptxo7QZk89I9rtdU2TnNwi3Zh%2F52OGJl2c&X-Amz-Signature=4eaa9cbdc45a95aa8319168f458469d8ddbc62af2a1e49d8ec5101e8512d80c5&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject","mimeType":"text/csv","text":"Export file: 1 rows in CSV format. Expires at 2/19/2026, 5:42:44 AM."}}]},"jsonrpc":"2.0","id":2}';

/**
 * Mem-parse raw SSE response dari Wattdata API dan mengembalikan
 * inner JSON (isi field "text") dalam bentuk pretty-print string.
 *
 * Struktur response SSE:
 *   event: message
 *   data: {"result":{"content":[{"type":"text","text":"{...escaped json...}"},...]},...}
 *
 * @param  string $rawResponse  Raw string response (boleh termasuk prefix "event: message\ndata: ")
 * @return string               Pretty-printed JSON atau pesan error
 */
function parseWattdataResponse(string $rawResponse): string
{
    // 1. Ambil bagian setelah "data: " jika ada prefix SSE
    if (strpos($rawResponse, 'data:') !== false) {
        $parts = explode('data:', $rawResponse, 2);
        $rawResponse = trim($parts[1]);
    }

    // 2. Decode outer JSON
    $outer = json_decode($rawResponse, true);
    if (json_last_error() !== JSON_ERROR_NONE) {
        return 'ERROR decode outer JSON: ' . json_last_error_msg();
    }

    // 3. Ambil inner JSON string dari result.content[0].text
    $innerJsonString = $outer['result']['content'][0]['text'] ?? null;
    if ($innerJsonString === null) {
        return 'ERROR: path result.content[0].text tidak ditemukan';
    }

    // 4. Decode inner JSON
    $inner = json_decode($innerJsonString, true);
    if (json_last_error() !== JSON_ERROR_NONE) {
        return 'ERROR decode inner JSON: ' . json_last_error_msg();
    }

    // 5. Kembalikan sebagai pretty-print JSON
    return json_encode($inner, JSON_PRETTY_PRINT | JSON_UNESCAPED_SLASHES | JSON_UNESCAPED_UNICODE);
}

// Simpan result ke file JSON
function saveToJson(string $jsonString, string $filePath): void
{
    file_put_contents($filePath, $jsonString);
    echo "Tersimpan ke: " . $filePath . PHP_EOL;
}


$resultResolveIdentities = parseWattdataResponse($rawResponseResolveIdentities);
$resultGetPerson = parseWattdataResponse($rawResponseGetPerson);

$jsonDir = __DIR__ . '/../Json/';
saveToJson($resultResolveIdentities, $jsonDir . 'resolve-identities.json');
saveToJson($resultGetPerson,         $jsonDir . 'get-person.json');

